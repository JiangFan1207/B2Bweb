!function(e,t,a,r){var o=e.document,n=Array.prototype.slice,l={}.hasOwnProperty,i=0,c="area-selector",s={up:38,down:40},d={};d[s.up]=1,d[s.down]=1;var u={SEARCH:300,HIDE_INPUT_BOX:200,RESET_POSITION:100},p=250,h={330281:1,44060011:1},_={ACTIVE_CLASS_NAME:"active",DISABLED_CLASS_NAME:"disabled"},f={hiddenFiled:'<input type="hidden" />',dropDownMenu:'<ul class="area-selector-dropdown-menu"></ul>',menuEmpty:'<li class="disabled"><a href="#">{{text}}</a></li>',menuItem:'{{#list}}<li data-value="{{value}}"><a href="#">{{city}}-{{country}}</a></li>{{/list}}',cityNav:'{{#data}}<li class="fl" data-target="{{name}}">{{name}}</li>{{/data}}',cityTabs:["{{#data}}",'<div class="pop-tab" data-target="{{name}}">','<ul class="area-selector-value area-selector-pop-city-list clearfix">',"{{#value}}",'<li class="fl area-selector-item" data-id="{{value}}" data-name="{{name}}" data-role="selectCity"><a href="#">{{name}}</a></li>',"{{/value}}","{{#children}}","<li>",'<ul class="area-selector-value area-selector-value-w clearfix">','<li class="fl area-selector-value-h"><h3>{{name}}</h3></li>','<li class="area-selector-value-b">','<ul class="area-selector-value clearfix">',"{{#value}}",'<li class="fl area-selector-item" data-id="{{value}}" data-name="{{name}}" data-role="selectCity"><a href="#">{{name}}</a></li>',"{{/value}}","</ul>","</li>","</ul>","</li>","{{/children}}","</ul>","</div>","{{/data}}"].join(""),emptyCountry:'<li class="disabled empty-data">没有数据</li>',countryItem:['{{#data}}<li class="fl area-selector-item" data-id="{{value}}" data-name="{{name}}" data-role="selectCountry"><a href="#">{{name}}</a></li>{{/data}}'].join(""),areaSelectorPop:['<div class="area-selector-pop">','<div class="area-selector-pop-header">支持文字输入<a href="#" class="close" data-action="hideAreaSelectorPop">×</a></div>','<div class="area-selector-pop-body">','<ul class="selector-pop-nav area-selector-pop-nav clearfix">','<li class="fl active" data-target="city">城市</li>','<li class="fl" data-target="country">区县</li>',"</ul>",'<div class="pop-tabs area-selector-pop-tabs">','<div class="pop-tab" data-target="city">','<ul class="selector-pop-nav area-selector-pop-city-nav clearfix">',"</ul>",'<div class="pop-tabs area-selector-pop-city-tabs">',"</div>","</div>",'<div class="pop-tab" data-target="country">','<ul class="area-selector-value area-selector-pop-country-list clearfix"></ul>',"</div>","</div>","</div>","</div>"].join("")},v="zsl-area-selector",m={searchTimer:null,hideDropdownMenuTimer:null,resetPositionTimer:null},g={getCityPromise:null,getCountryPromise:null,searchPromise:null},y={getters:[],isNotChained:function(e,a){var r=a.length;return"option"==e&&(0===r||1===r&&"string"==typeof a[0])?!0:!!~t.inArray(e,y.getters)}},S=["<style>",".area-selector-dropdown-menu{position: absolute; top: 100%; left: 0; z-index: 1000; display: none; float: left; min-width: 160px; list-style: none; background-color: #fff; border: 1px solid #ccc; padding: 0; margin:1px 0 0; min-height:32px; overflow: hidden; overflow-y: auto;}",".area-selector-dropdown-menu li a{display: block; padding:6px 14px; clear: both; font-weight: normal; line-height: 20px; color: #333; white-space: nowrap}",".area-selector-dropdown-menu li a:hover, .area-selector-dropdown-menu li a:focus{color: #fff; text-decoration: none; background-color: #3399EE;}",".area-selector-dropdown-menu .active a, .area-selector-dropdown-menu .active a:hover, .area-selector-dropdown-menu .active a:focus{color: #fff; text-decoration: none; background-color: #3399EE; outline: 0;}",".area-selector-dropdown-menu .disabled a, .area-selector-dropdown-menu .disabled a:hover, .area-selector-dropdown-menu .disabled a:focus{color: #999}",".area-selector-dropdown-menu .disabled a:hover, .area-selector-dropdown-menu .disabled a:focus{text-decoration: none; cursor: default; background-color: transparent;}",".area-selector-pop{display: none; border: 1px solid #999; background: #FFF; padding: 8px 0; width: 408px; position: absolute;}",".area-selector-pop ul{list-style: none; margin: 0; padding: 0;}",".area-selector-pop a{text-decoration: none;}",".area-selector-pop-header{padding: 0 13px; color: #999; position: relative; font-size: 12px;}",".area-selector-pop-header a{font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #999; text-decoration: none; font-size: 20px; line-height: 20px; position: absolute; top: -2px; right: 8px; cursor: pointer;}",".area-selector-pop-header a:hover{color: #666}",".area-selector-pop-body{padding: 18px 0 10px;}",".area-selector-pop .area-selector-pop-nav{padding: 0 13px 14px;}",".area-selector-pop-nav li{width: 50%; background: #e3e3e3; color: #999; height: 30px; line-height: 30px; text-align: center; cursor: pointer;}",".area-selector-pop-nav .active{background: #3295e8; color: #FFF; cursor: default;}",".pop-tab{display: none;}",".pop-tabs .active{display: block;}",".area-selector-pop-city-nav{border-bottom: 2px solid #e9e9e9; font-size: 14px;}",".area-selector-pop .area-selector-pop-city-nav{margin-bottom: 12px;}",".area-selector-pop-city-nav li{margin: 0 13px; color: #0088dd; line-height: 2em; margin-bottom: -2px; cursor: pointer;}",".area-selector-pop-city-nav .active{border-bottom: 2px solid #0088dd; color: #3193e5; font-weight: bold; cursor: default;}",".area-selector-value .area-selector-item{padding: 6px 0 6px 20px; display: block; }",".area-selector-value .area-selector-item a{display: block;white-space:nowrap}",".area-selector-value li{font-size: 12px;}",".area-selector-value a{color: #333;}",".area-selector-pop .area-selector-value-w{padding: 0 14px;}",".area-selector-value-h{padding: 6px 0 6px 0; font-weight: bold;}",".area-selector-value-b{padding: 0 0 0 10px;}",".area-selector-value a:hover, .area-selector-value .active a{color: #0066ff;}",".area-selector-value .active a{cursor: default;}",".area-selector-pop .empty-data{text-align: center;}",".area-selector-pop .area-selector-pop-country-list{padding-right: 14px;}","</style>"].join("");t("head",o).append(S);var C=function(e){return new C.prototype._init(e)},x=C.prototype;return t.extend(x,{options:{zIndex:1,flag:"",target:null,disabled:!0,remote:{url:{getCity:"",searchCity:"",getCountry:""},parse:function(e){return{data:e}},requestType:"get",paramName:"keyWord"},hiddenFiled:null,selectedCallback:null},destroy:function(){var a=this;a._clearTimer()._abortPromise(),t(o).off("."+a._containerId).off("."+c),a._$areaSelectorPop.off("."+a._containerId).off("."+c),a._$dropdownMenu.off("."+c),t(e).off("."+c),a._events.off(),a._revertBack();for(var r in a)l.call(a,r)&&(a[r]=null,delete a[r]);return a},disable:function(){var e=this;return e._disbled=!0,e._$targetInput.prop({disabled:!0}),e},enable:function(){var e=this;return e._disbled=!1,e._$targetInput.prop({disabled:!1}),e},getInput:function(){return this._$targetInput},getHiddenFiled:function(){return this._$hiddenFiled},on:function(){var e=this,t=e._events;return t.on.apply(t,arguments),e},off:function(){var e=this,t=e._events;return t.off.apply(t,arguments),e},trigger:function(){var e=this,t=e._events;return t.trigger.apply(t,arguments),e},_init:function(e){var a=this;a._options=t.extend(!0,{},a.options,e),a._cacheParam()._initComponent()._bindEventListener()},_initComponent:function(){var e,a,r=this,o=r._target;return a=o.jquery?o:t(o),a&&a.length?(r._containerId=e=c+"-"+i++,r._$targetInput=a.addClass("auto-complete-target auto-complete-target-"+e).attr({"data-idpx":e,autocomplete:"off"}),r._createAreaSelectorPop()._createDropDownMenu()._createHiddenFiled()):t.error("初始化时，请传入$target参数"),r},_revertBack:function(){var e=this,t=e._$targetInput;return t.removeClass("auto-complete-target").removeAttr("data-idpx"),e},_setPosition:function(e){var t=this,a=t._$targetInput,r=a.offset();return(e||t._$dropdownMenu).css({left:r.left+"px","min-width":a.outerWidth()+"px",top:a.outerHeight()+r.top+"px"}),t},_createHiddenFiled:function(){var e,a,r=this,o=r._hiddenFiled;return o&&(e=t.trim(o.name))&&(a=r._$targetInput.closest("form").find('input:hidden[name="'+e+'"]'),a.length||(a=t(f.hiddenFiled).attr({name:e}),r._$targetInput.after(a)),r._$hiddenFiled=a),r},_createAreaSelectorPop:function(){var e,r=this;return e=r._$areaSelectorPop=r._$body.find(".area-selector-pop"),e.length||(r._abortPromise("getCityPromise"),r._abortPromise("getCountryPromise"),e=r._$areaSelectorPop=t(f.areaSelectorPop).appendTo(r._$body),g.getCityPromise=t.getScript(r._remote.url.getCity).done(function(){var e,o,n={},l=[];e=_CITY_DATA,l.push({name:"周边城市",value:e["周边城市"]||[]}),e["周边城市"]=null,delete e["周边城市"],t.each(e,function(e,a){n={},o=[],n.name=e,t.each(a,function(e,a){o.push(t.extend(!0,{},{name:e,value:a}))}),n.children=o,l.push(n)}),r._$areaSelectorPopCityNav.html(a.render(f.cityNav,{data:l})),r._$areaSelectorPopCityTabs.html(a.render(f.cityTabs,{data:l}))}).fail(function(e,t){}).always(function(){g.getCityPromise=null})),e.attr("data-idpx",r._containerId),t.each([".area-selector-pop-city-nav",".area-selector-pop-city-tabs",".area-selector-pop-country-list"],function(e,a){r["_$"+t.camelCase(a.replace(/\#|\./g,""))]=t(a)}),r},_createDropDownMenu:function(){var e,a=this;return e=a._$dropdownMenu=a._$body.find(".area-selector-dropdown-menu"),e.length||(e=a._$dropdownMenu=t(f.dropDownMenu).appendTo(a._$body)),e.attr("data-idpx",a._containerId),a},_cacheParam:function(){var e,a=this,r=a._options;for(e in r)a["_"+e]=r[e];return a._events=t({}),a._$body=t(o.body),a},_bindEventListener:function(){var a=this,r=a._containerId,n=".auto-complete-target-"+r,l=a._eventCallbacks;return t(o).off("click."+c).on("click."+c,function(e){l.clickOthers.call(a,e,t(e.target))}).on("keydown."+r,n,function(e){l.keydownInputbox.call(a,e,t(this))}).on("focusin."+r,n,function(e){l.showAreaSelectorPop.call(a,e,t(this))}).on("keyup."+r,n,function(e){l.changeInputBox.call(a,e,t(this))}),a._$dropdownMenu.off("."+c).on("click."+c,"li",function(e){l.clickDropdownMenuItem.call(a,e,t(this))}),a._$areaSelectorPop.off("."+c).on("click."+c,".selector-pop-nav li",function(e){l.selectTabNav.call(a,e,t(this))}).on("click."+c,".area-selector-item",function(e){l.selectPopItem.call(a,e,t(this))}).on("click."+c,"[data-action]",function(e){var r=t(this),o=t.trim(r.data("action"));!l[o]||r.data("pending")||r.prop("disabled")||r.hasClass("disabled")||l[o].call(a,e,t(this)),e.preventDefault()}),t(e).off("."+c).on("resize."+c,function(e){l.resetPosition.call(a,e,t(this))}),a},_selectResult:function(e,t){var a=this,r=a._getAreaSelectorInstanceByIdx(a._$areaSelectorPop),o=r._cacheData[t.closest("ul").children().index(t)];return r._$targetInput.val(e.text).attr("data-idv",e.value),r._$hiddenFiled&&r._$hiddenFiled.val(e.value),r._selectedCallback&&r._selectedCallback(e,r,o),r.trigger("selected",[e,r,o]),r=null,a},_getAreaSelectorInstanceByIdx:function(e){return t('.area-selector[data-idpx="'+t.trim(e.attr("data-idpx"))+'"]').data(v)},_keyDownToSelectResult:function(){var e=this,t=e._getAreaSelectorInstanceByIdx(e._$areaSelectorPop);return e._isSearchNoEmpty()&&(t._$targetInput.blur(),t._eventCallbacks.focusoutInputBox.call(t)),t=null,e},_keyBoardNavigate:function(e,t){var a,r,o,n,l=this;if(d[e]&&l._isSearchNoEmpty()){if(a=s.up===e,o=l._$dropdownMenu,n=l._$dropdownMenu.children(),r=o.find("."+_.ACTIVE_CLASS_NAME),r.length)if(r.removeClass(_.ACTIVE_CLASS_NAME),a)for(r=r.prev();r.length&&r.hasClass(_.DISABLED_CLASS_NAME);)r=r.prev();else for(r=r.next();r.length&&r.hasClass(_.DISABLED_CLASS_NAME);)r=r.next();else r=o.children().not("."+_.DISABLED_CLASS_NAME).first();r.length&&(r.addClass(_.ACTIVE_CLASS_NAME),l._scrollIntoView(r)),t.preventDefault()}return l},_scrollIntoView:function(e){var t,a,r,o,n=this,l=n._$dropdownMenu;return n._hasScroll()&&(t=e.offset().top-l.offset().top,a=l.scrollTop(),o=l.height(),r=e.outerHeight(),0>t?l.scrollTop(a+t):t+r>o&&l.scrollTop(a+t-o+r)),n},_hasScroll:function(){var e=this._$dropdownMenu;return e.outerHeight()<e.prop("scrollHeight")},_toSeach:function(e){var t=this;return t._clearTimer("searchTimer")._abortPromise("searchPromise"),e?m.searchTimer=setTimeout(function(){t._search(e)},u.SEARCH):t._$dropdownMenu.html("").hide(),t},_search:function(e){var a,r=this,o={},n=r._getAreaSelectorInstanceByIdx(r._$areaSelectorPop),l=n._remote,i=f.menuEmpty;return o[l.paramName]=e,g.searchPromise=t.getJSON(l.url.searchCity+"?callback=?",o),g.searchPromise.done(function(e){var r;"function"===t.type(l.parse)&&(e=l.parse(e)),(r=e.data)&&r.length?(i=l.tpl||f.menuItem,a={list:r}):a={text:"没有找到匹配的内容"},n._cacheData=r||null}).fail(function(e,t){"abort"!==t&&(a={text:"搜索失败，请稍后重试"}),n._cacheData=null}).always(function(){n._renderDropdownMenu(i,a),g.searchPromise=a=l=i=n=null}),r},_isSearchNoEmpty:function(){var e=this._$dropdownMenu;return!!e.children().not("."+_.DISABLED_CLASS_NAME).length},_renderDropdownMenu:function(e,t){var r,o,n,l=this,i=l._$dropdownMenu,c=l._getAreaSelectorInstanceByIdx(l._$areaSelectorPop);return t?(i.html(a.render(e,t))[c._options.flag?"attr":"removeAttr"]("data-flag",c._options.flag),n=i.find("li").not("."+_.DISABLED_CLASS_NAME),c._setPosition(i),i.show(),(o=l._getDropdownMenuHeight())>p&&(o=p),i.height(o),1===r&&n.addClass(_.ACTIVE_CLASS_NAME)):c._hideDropdownMenu(0,null,!1),c=null,l},_getDropdownMenuHeight:function(){var e=0;return this._$dropdownMenu.children().each(function(){e+=t(this).outerHeight(!0)}),e},_hideDropdownMenu:function(e,a,r){var o=this,e=e||0,n=function(){var e=o._getAreaSelectorInstanceByIdx(o._$areaSelectorPop);t.trim(e._$targetInput.attr("data-idv"))||r===!1||e._$targetInput.val(""),o._$dropdownMenu.html("").scrollTop(0).hide(),e=null};return o._clearTimer("hideDropdownMenuTimer"),e?m.hideDropdownMenuTimer=setTimeout(function(){a&&a.call(o),n()},e):n(),o},_clearTimer:function(e){var a=this;return null!=e&&m[e]?(clearTimeout(m[e]),m[e]=null):null==e&&t.each(m,function(e,t){m[e]&&(clearTimeout(m[e]),m[e]=null)}),a},_abortPromise:function(e){var a=this;return null!=e&&g[e]?(g[e].abort(),g[e]=null):null==e&&t.each(g,function(e,t){g[e]&&(g[e].abort(),g[e]=null)}),a},hideDropdownMenu:function(e,t,a){var r=this;return r._hideDropdownMenu(e||0,t||null,null==a?!0:a),r},hideAreaSelectorPop:function(e){var a,r=this;a=r._getAreaSelectorInstanceByIdx(r._$areaSelectorPop),t.trim(a._$targetInput.attr("data-idv"))||e===!1||a._$targetInput.val(""),r._abortPromise("getCountryPromise"),r._$areaSelectorPopCountryList.html(""),a._cityData=null,r._$areaSelectorPop.hide()},_eventCallbacks:{clickOthers:function(e,t){var a=this,r=a._getAreaSelectorInstanceByIdx(a._$areaSelectorPop);if(t[0]!==r.getInput()[0]&&!t.closest(".area-selector-pop").length&&!t.closest(".area-selector-dropdown-menu").length){var o=r.getInput().parent().find("input:hidden").val();a._hideDropdownMenu(0,null,!o),a._eventCallbacks.hideAreaSelectorPop.call(a,!o)}r=null},focusoutInputBox:function(){var e=this;e._hideDropdownMenu(u.HIDE_INPUT_BOX,function(){this._$dropdownMenu.find("."+_.ACTIVE_CLASS_NAME).click()})},keydownInputbox:function(e,t){var a=e.keyCode;13===a?(this._keyDownToSelectResult(),e.preventDefault()):this._keyBoardNavigate(a,e,t)},clickDropdownMenuItem:function(e,a){var r=this;a.hasClass(_.DISABLED_CLASS_NAME)||(r._$dropdownMenu.find("."+_.ACTIVE_CLASS_NAME).removeClass(_.ACTIVE_CLASS_NAME),a.addClass(_.ACTIVE_CLASS_NAME),r._selectResult({text:t.trim(a.text()),value:t.trim(a.attr("data-value"))},a)),r._hideDropdownMenu(0),e.preventDefault()},changeInputBox:function(e,a){var r,o=this,n=e.keyCode,l=o._getAreaSelectorInstanceByIdx(a);d[n]||13==n||(r=t.trim(a.val()),l._oldText!==r&&(l._oldText=r,a.removeAttr("data-idv"),l._$hiddenFiled&&l._$hiddenFiled.val(""),l._toSeach(r))),o._eventCallbacks.hideAreaSelectorPop.call(o,!1),l=null},showAreaSelectorPop:function(e,a){var r,o=this,n=o._$areaSelectorPop;o._hideDropdownMenu(0,null,!1),r=o._getAreaSelectorInstanceByIdx(n),r._oldText="",n.attr("data-idpx",a.attr("data-idpx")),r=o._getAreaSelectorInstanceByIdx(n),r._setPosition(n),o._abortPromise("getCountryPromise"),o._$areaSelectorPopCountryList.html(""),r._cityData=null,n.find(".selector-pop-nav").each(function(){t(this).children().removeClass(_.ACTIVE_CLASS_NAME).first().addClass(_.ACTIVE_CLASS_NAME)}).end().find(".pop-tabs").each(function(){t(this).children().removeClass(_.ACTIVE_CLASS_NAME).first().addClass(_.ACTIVE_CLASS_NAME)}).end().css({zIndex:r._options.zIndex}).show()[o._options.flag?"attr":"removeAttr"]("data-flag",r._options.flag),r=null},hideAreaSelectorPop:function(e){var t=this;t.hideAreaSelectorPop(e)},selectTabNav:function(e,a){var r,o=this,n=_.ACTIVE_CLASS_NAME;target=t.trim(a.data("target")),a.hasClass(n)||(a.closest(".selector-pop-nav").children().removeClass(n).end().end().addClass(n),r=t('.pop-tab[data-target="'+target+'"]'),r.closest(".pop-tabs").children().removeClass(n).end().end().addClass(n),"city"===target&&(o._$areaSelectorPopCountryList.html(""),t('.selector-pop-nav>li[data-target="周边城市"]').click()))},selectPopItem:function(e,a){var r=this,o=t.trim(a.data("role"));r._eventCallbacks[o].call(r,a.data("name"),a.data("id")),e.preventDefault()},selectCity:function(e,r){var o,n=this,l=n._getAreaSelectorInstanceByIdx(n._$areaSelectorPop);l._cityData={name:e,value:r},n._abortPromise("getCountryPromise"),h[r]?n._eventCallbacks.selectCountry.call(l,e,r,!0):g.getCountryPromise=t.getJSON(l._remote.url.getCountry+"?callback=?",{cityId:r}).done(function(e){o=e&&e.length?a.render(f.countryItem,{data:e}):f.emptyCountry}).fail(function(e,t){"abort"!==t&&(o=f.emptyCountry)}).always(function(){o&&(n._$areaSelectorPopCountryList.html(o),t('.area-selector-pop-nav>li[data-target="country"]').click()),g.getCountryPromise=l=null})},selectCountry:function(e,t,a){var r=this,o=r._getAreaSelectorInstanceByIdx(r._$areaSelectorPop);o._$hiddenFiled&&o._$hiddenFiled.val(t),o._$targetInput.val(a===!0?o._cityData.name:[o._cityData.name,e].join("-")).attr("data-idv",t),o._selectedCallback&&o._selectedCallback({text:e,value:t},o,{value:t,country:e,city:o._cityData.name}),o.trigger("selected",[{text:e,value:t},o,{value:t,country:e,city:o._cityData.name}]),r._eventCallbacks.hideAreaSelectorPop.call(r),o=null},resetPosition:function(e,t){var a,r=this;r._clearTimer("resetPositionTimer"),m.resetPositionTimer=setTimeout(function(){a=r._getAreaSelectorInstanceByIdx(r._$areaSelectorPop),a._setPosition(r._$dropdownMenu)._setPosition(r._$areaSelectorPop),a=r=null},u.RESET_POSITION)}}}),x._init.prototype=x,t.fn.areaSelector=function(e){var a,r=this.eq(0),o=v,l=n.call(arguments,1);if(y.isNotChained(e,l)){if((a=r.data(o))||t.error("请先初始化"),"_"!==e.charAt(0)&&a[e])return a[e].apply(a,l);t.error("不存在"+e+"方法")}return this.each(function(a,r){var n=t(this),i=n.data(o);"string"==typeof e?(i||t.error("请先初始化"),"_"!==e.charAt(0)&&i[e]?i[e].apply(i,l):t.error("不存在"+e+"方法")):(i&&"function"==typeof i.destroy&&i.destroy(),l.length&&(e=t.extend.apply(null,[!0,e].concat(l))),i=new C(t.extend(!0,{},e,{target:n,hiddenFiled:{name:n.data("hidden")}})),n.data(o,i))})},C}(this,jQuery,Mustache);
